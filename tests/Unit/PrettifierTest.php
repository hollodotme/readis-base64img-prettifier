<?php declare(strict_types=1);

namespace hollodotme\Readis\Prettifiers\Base64Image\Tests\Unit;

use hollodotme\Readis\Prettifiers\Base64Image\Prettifier;
use PHPUnit\Framework\TestCase;

final class PrettifierTest extends TestCase
{
	/** @var Prettifier */
	private $prettifier;

	protected function setUp()
	{
		$this->prettifier = new Prettifier();
	}

	protected function tearDown()
	{
		$this->prettifier = null;
	}

	/**
	 * @param string $data
	 * @param string $expectedResult
	 *
	 * @throws \PHPUnit\Framework\ExpectationFailedException
	 * @throws \SebastianBergmann\RecursionContext\InvalidArgumentException
	 * @dataProvider prettifyProvider
	 */
	public function testPrettify( string $data, string $expectedResult ) : void
	{
		$this->assertSame( $expectedResult, $this->prettifier->prettify( $data ) );
	}

	public function prettifyProvider() : array
	{
		return [
			[
				'data'           => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAVlQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////qOe5EwAAAHJ0Uk5TACFHPAsCKggRJCw1BXGIe20Hkxw7fpF0jE9zVT6OCpw/WoOPYXB1p4QGpYKUhpcmWwQJHT2BA1E6axUrXGQjU6GeASeVo4mF7Jrg8avExRnTEIDa7UU261IO5UYf5Gci5mLWoMpZQfXS3Fju2N8pUBJLhUy2dQAAAAFiS0dEcjYODVgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAADVSURBVBjTY2DAAIxMzCysbOwcnAxcTNw8QAFePn4BQSFhEVEGMXEJSaCAlLSMrJy8gqISgzK3iipQQE1dQ0RTS1tHl0FPT1sfpMLAkMFIz9jElEGZ2QxkqLkFA4OmpZW1DYOtHdgWewdHAQ5WJwZnF1c3NpCAu4enlxsrA4OIt4+vnz9QQDcgMCgYyBAJCQ0LjwALRNpGcYIEomNibSECcbF2YIH4hESQQBJnckogSMA8NTwNKKCdnpGZBaQtsnNyhYyAjDzzfC6gJQwFhREyLJh+ZwAAuSkhy33cAkcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMDktMTdUMDk6NTk6MzIrMDA6MDCoe1TOAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTA5LTE3VDA5OjU5OjMyKzAwOjAw2SbscgAAAEZ0RVh0c29mdHdhcmUASW1hZ2VNYWdpY2sgNi43LjgtOSAyMDE0LTA1LTEyIFExNiBodHRwOi8vd3d3LmltYWdlbWFnaWNrLm9yZ9yG7QAAAAAYdEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAYdEVYdFRodW1iOjpJbWFnZTo6aGVpZ2h0ADE5Mg8AcoUAAAAXdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgAMTky06whCAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNTA1NjQyMzcyQ2Oo5QAAAA90RVh0VGh1bWI6OlNpemUAMEJClKI+7AAAAFZ0RVh0VGh1bWI6OlVSSQBmaWxlOi8vL21udGxvZy9mYXZpY29ucy8yMDE3LTA5LTE3LzZjNTJkMzIyNTNmM2IyNTc1Y2I4MjUyNjdmYTVhZjM5Lmljby5wbmf0XuKTAAAAAElFTkSuQmCC',
				'expectedResult' => '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAVlQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////qOe5EwAAAHJ0Uk5TACFHPAsCKggRJCw1BXGIe20Hkxw7fpF0jE9zVT6OCpw/WoOPYXB1p4QGpYKUhpcmWwQJHT2BA1E6axUrXGQjU6GeASeVo4mF7Jrg8avExRnTEIDa7UU261IO5UYf5Gci5mLWoMpZQfXS3Fju2N8pUBJLhUy2dQAAAAFiS0dEcjYODVgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAADVSURBVBjTY2DAAIxMzCysbOwcnAxcTNw8QAFePn4BQSFhEVEGMXEJSaCAlLSMrJy8gqISgzK3iipQQE1dQ0RTS1tHl0FPT1sfpMLAkMFIz9jElEGZ2QxkqLkFA4OmpZW1DYOtHdgWewdHAQ5WJwZnF1c3NpCAu4enlxsrA4OIt4+vnz9QQDcgMCgYyBAJCQ0LjwALRNpGcYIEomNibSECcbF2YIH4hESQQBJnckogSMA8NTwNKKCdnpGZBaQtsnNyhYyAjDzzfC6gJQwFhREyLJh+ZwAAuSkhy33cAkcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMDktMTdUMDk6NTk6MzIrMDA6MDCoe1TOAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTA5LTE3VDA5OjU5OjMyKzAwOjAw2SbscgAAAEZ0RVh0c29mdHdhcmUASW1hZ2VNYWdpY2sgNi43LjgtOSAyMDE0LTA1LTEyIFExNiBodHRwOi8vd3d3LmltYWdlbWFnaWNrLm9yZ9yG7QAAAAAYdEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAYdEVYdFRodW1iOjpJbWFnZTo6aGVpZ2h0ADE5Mg8AcoUAAAAXdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgAMTky06whCAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNTA1NjQyMzcyQ2Oo5QAAAA90RVh0VGh1bWI6OlNpemUAMEJClKI+7AAAAFZ0RVh0VGh1bWI6OlVSSQBmaWxlOi8vL21udGxvZy9mYXZpY29ucy8yMDE3LTA5LTE3LzZjNTJkMzIyNTNmM2IyNTc1Y2I4MjUyNjdmYTVhZjM5Lmljby5wbmf0XuKTAAAAAElFTkSuQmCC" alt="Image from base64 data">',
			],
		];
	}

	/**
	 * @param string $data
	 * @param bool   $expectedResult
	 *
	 * @throws \PHPUnit\Framework\ExpectationFailedException
	 * @throws \SebastianBergmann\RecursionContext\InvalidArgumentException
	 * @dataProvider canPrettifyProvider
	 */
	public function testCanPrettify( string $data, bool $expectedResult ) : void
	{
		$this->assertSame( $expectedResult, $this->prettifier->canPrettify( $data ) );
	}

	public function canPrettifyProvider() : array
	{
		return [
			[
				'data'           => 'This is no base64 data',
				'expectedResult' => false,
			],
			[
				'data'           => 'data:image/;;base64,not valid',
				'expectedResult' => false,
			],
			[
				'data'           => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAVlQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////qOe5EwAAAHJ0Uk5TACFHPAsCKggRJCw1BXGIe20Hkxw7fpF0jE9zVT6OCpw/WoOPYXB1p4QGpYKUhpcmWwQJHT2BA1E6axUrXGQjU6GeASeVo4mF7Jrg8avExRnTEIDa7UU261IO5UYf5Gci5mLWoMpZQfXS3Fju2N8pUBJLhUy2dQAAAAFiS0dEcjYODVgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAADVSURBVBjTY2DAAIxMzCysbOwcnAxcTNw8QAFePn4BQSFhEVEGMXEJSaCAlLSMrJy8gqISgzK3iipQQE1dQ0RTS1tHl0FPT1sfpMLAkMFIz9jElEGZ2QxkqLkFA4OmpZW1DYOtHdgWewdHAQ5WJwZnF1c3NpCAu4enlxsrA4OIt4+vnz9QQDcgMCgYyBAJCQ0LjwALRNpGcYIEomNibSECcbF2YIH4hESQQBJnckogSMA8NTwNKKCdnpGZBaQtsnNyhYyAjDzzfC6gJQwFhREyLJh+ZwAAuSkhy33cAkcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMDktMTdUMDk6NTk6MzIrMDA6MDCoe1TOAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTA5LTE3VDA5OjU5OjMyKzAwOjAw2SbscgAAAEZ0RVh0c29mdHdhcmUASW1hZ2VNYWdpY2sgNi43LjgtOSAyMDE0LTA1LTEyIFExNiBodHRwOi8vd3d3LmltYWdlbWFnaWNrLm9yZ9yG7QAAAAAYdEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAYdEVYdFRodW1iOjpJbWFnZTo6aGVpZ2h0ADE5Mg8AcoUAAAAXdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgAMTky06whCAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNTA1NjQyMzcyQ2Oo5QAAAA90RVh0VGh1bWI6OlNpemUAMEJClKI+7AAAAFZ0RVh0VGh1bWI6OlVSSQBmaWxlOi8vL21udGxvZy9mYXZpY29ucy8yMDE3LTA5LTE3LzZjNTJkMzIyNTNmM2IyNTc1Y2I4MjUyNjdmYTVhZjM5Lmljby5wbmf0XuKTAAAAAElFTkSuQmCC',
				'expectedResult' => true,
			],
		];
	}
}
